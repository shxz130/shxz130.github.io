---
layout : life
title : "并行程序优化之Fork/Join框架"
category : java并行优化
duoshuo: true
date : 2014-12-01
---

----------------

* 通过**分治技术(Divide and Conquer)**将问题拆分成小任务的问题。
* 在一个任务中，先检查将要解决的问题的大小
 * 如果问题大于设定的大小，就将问题拆分成可以通过框架来执行的小问题。
 * 如果问题小于问题的大小，直接在任务里解决这个问题。
* **问题的大小**没有固定的公式来决定，拆分与否取决于任务本身的特性。
* 将**ForkJoinPool类**当作一个特殊的Executor执行器类型,这个框架有以下梁总操作。
 * **分解(Fork)操作**：当需要将一个任务拆分成更小的多个任务时，在框架中执行这些任务。
 * **合并(Join)操作**：当一个主任务等待其创建的多个子任务的完成执行。
 

----------------

![onepiece](/life/picture/forkjoin.jpg)

------------------

##Fork/Join框架和执行器框架的区别：

------------------

* **工作窃取算法(Work-Stealing Algorithm)**的不同
 * 使用Join操作让一个主任务等待它所创建的子任务的完成，执行这个任务的线程称之为**工作者线程(Worker Thread)**。
 * 工作者线程寻找其他未被执行的任务，然后开始执行，通过这种方式，这些线程在运行时才具有所有的优点，进而提升应用程序的性能。
* **Fork/Join框架执行任务的限制**
 * **任务只能使用fork和join操作当作同步机制**，如果使用其他同步机制，工作线程就不能执行其他任务。
 * **任务不能执行I/O操作**，比如文件数据的读写。 

--------------------

##Fork/Join框架的核心组成

--------------------

* **ForkJoinPool**: 实现了**ExecutorService**接口和工作窃取算法(Work-Stealing Algorithm),它管理工作者线程，并提供任务的状态信息，以及任务的执行信息。
* **ForkJoinTask**: 一个将在ForkJoinPool中执行的任务的基类。
* **RecursiveAction**:用于没有返回结果的场景。
* **RecursiveTask**:用于任务有返回结果的场景。

----------------------------




