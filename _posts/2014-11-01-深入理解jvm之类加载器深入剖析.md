---
layout : life
title : "深入理解jvm之类加载器"
category : 深入理解java
duoshuo: true
date : 2014-11-01
---

#类加载机制
-----
##在如下情况下java虚拟机会结束生命周期
-----

* ###在执行了System.exit()方法。
* ###程序正常执行完毕
* ###程序执行过程中遇到了异常或错误而异常终止
* ###由于操作系统发生错误而导致java虚拟机进程终止

-----

##类加载，连接和初始化
-----
*
###加载：查找并加载类的二进制数据
* 
###链接
 * 
 ####验证：确保被加载的类的正确性
 * ####准备：为类的静态变量分配内存，并将其初始化为默认值
 * ####解析：把类中的符号转换为直接引用。

* ###初始化：为类的静态变量赋予正确的初始值。
   ------
   ##java对类的使用方法
   ------
   * ###主动使用
   * ###被动使用
   ###所有的java虚拟机实现必须在每个类或接口被java程序`首次主动使用`时才被初始化。
   ------
   ##主动使用（六种）
   ----
   * ####创建类的实例
   * ####访问某个类或者接口的静态变量，或者对该静态变量赋值
   * ####调用类的静态方法
   * ####反射（如Class.forName("com.lang.String"));
   * ####初始化一个类的子类
   * ####java虚拟机启动时被标明为启动类的类
   #####除了以上六种，其他都被看作是对类的被动使用，都不会导致类的初始化。
   ----

   ##类的加载
   -----
   ###类的加载是指将类的.class文件中的二进制数据读到内存中，将其放在运时数据区的方法区内，然后在堆区创建一个java.lang.Class对象，用来封装类在方法区内的数据结构。
   ###加载.class文件的方式
   * ####从本地系统上直接加载。
   * ####通过网络下载.class文件。
   * ####从zip，jar等归档文件中哦功能加载.class文件。
   * ####从转悠数据库中获取.class文件
   * ####将java源文件动态编译为.class文件

   #类的加载器
    ##两种类型的类加载器
    * ###java虚拟机自带的加载器
     * ###根类加载器（Bootstrap)C++实现
     * ###扩展加载器（Extension)java实现
     * ###系统类加载器（System)java实现
    * ###用户自定义的类加载器        
     * ###java.lang.ClassLoader的子类
     * ###用户可以定制类的加载方式
	  * ###类加载器不需要等到某个类被首次主动使用时再加载（也就是说jvm允许类加载器在预料某个类将要首次使用时就预先加载它，如果在过程中遇到了.class文件缺失或者说存在错误，类加载器不会主动去报告出来，当类加载器在首次主动使用该类时，才报告错误，LinkageError错误）
```java
	Class clazz=Class.forname("java.lang.String");
	System.out.println(clazz.getClassLoader());
```
##result:null
###对象不能根类记载器，返回null来代替根类加载器。
-----
##类的验证
------
* ###类文件的结构检查
确保类文件总从java类文件的固定格式
* ###语义检查
确保类本身符合java语言的语法规定

* ###字节码验证
确保字节码流可以被java虚拟机安全的执行。（静态方法，实例对象）
* ###二进制兼容性的验证
引用类之间协调一致。
------
##类的准备，解析
----
* ###准备阶段，java虚拟机对类的静态变量分配内存，并设置初始值。
* ###解析阶段，java虚拟机会把类的二进制数据中的符号引用代替为直接引用。
----
##类的初始化
----
###在初始化阶段，java虚拟机执行类的初始化语句，为类的静态变量赋予初始值。
###静态变量的初始化途径：
* ####在静态变量的声明处进行初始化。
* ####在静态代码课中进行初始化。

###初始化注意要点
* ####java虚拟机初始化一个类时，要求它的父类都已经被初始化，但是这条规则并不适合与接口。
* ####在初始化一个类时，并不会先初始化它的接口。
* ####在初始化一个接口时，并不会初始化它的父接口。
* ####调用ClassLoader类的loadClass方法加载一个类，并不是对类的主动使用，不会导致类的初始化。
---
##类加载器的父委托机制
----
## 加载器之间的父子关系实际上指的是加载器对象之间的包装关系，而不是类之间的继承关系。
##优点：提高软件系统的安全性。
----
```
```
