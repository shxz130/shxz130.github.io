---
layout : life
title : "深入浅出jvm之类结构"
category : 深入理解JVM
duoshuo: true
date : 2014-11-06
---
------------

##一次编写，处处运行

------------

* 实现在**应用层**。
* **原理**：载入一种平台不管的字节码，从而实一次编写，处处运行。
* **基础**：**虚拟机**和**字节码存储格式**，使用Java编辑器可以把java代码编译为存储字节码的Class文件。
* java虚拟机上的其他语言:JRuby,Jython,Scala,Clojure,Groovy...

-------------

##Class类文件的结构

-------------

* Class是一组以八进制为基本单位的二进制流。

* Class文件格式
	* 采用一种类似于C结构体的伪结构体,只有两种数据结构：**无符号数**和**表**；
	* **无符号数**：基本的数据类型：u1,u2,u4,u8分别代表1,2,4,8个字节，可以描述数字，索引引用，数量值，字符串值等。
	* **表**：多个无符号数或其他表作为数据项构成的复合数据类型。一般以**_info**结尾。

* 组成：
	* 魔数：前四个字节
	* 主次版本号：紧接着魔数四个字节
	* 常量池：紧接着主次版本号
	* 访问标志：紧接着常量池两个字节。

------------

##魔数

-------------

* **位置**：Class文件的头四个字节。
* **作用**：判定该文件是否能够被虚拟机接收的Class文件。

------------

##主次版本号

-------------

* **位置**：魔数后面紧接着四个字节存储
* **作用**：5,6是次版本号，7,8是主版本号。

-------------

##常量池

-------------

* **位置**：主次版本号之后是常量池入口
* **重要性**：Class文件结构中与其他项目关联最多的数据类型，也是占用Class文件空间最大的数据结构之一，还是在Class文件中第一个出现的表类型数据项目。
* **常量池计数值**：常量的数量不固定，所以需要在**入口**放置一项**u2类型**的数据。代表**常量池计数值**。
* **两大类常量**
	* **字面量**：接近于java语言层面的常量概念：文本字符串，被声明的final类型的常量值。
	* **符号引用**：编译原理方面的概念，包括三类常量：
		* 类和接口的全限定名。
		* 字段的名称和修饰符。
		* 方法的名称和描述符。
* 常量池的每一项常量都是一个表。

--------------

##访问标志(access_flags)
* **位置**:紧接着常量池两个字节。
* **作用**:用于识别一些类或者接口层次的访问信息，包括：该Class是类还是接口，是否定义为public类型或者abstract类型。


--------------

##类索引、父类索引与接口集合

--------------

* * **位置**：类索引、父类索引与接口集合按顺序排列在访问标志之后。
* 类索引、父类索引都是一个u2类型的数据，而接口索引集合是一组u2类型的集合。

-------------

##字段表集合

-------------

* 描述接口或者类中声明的变量。
* 字段表集合不会列出超类或者父接口中继承而来的字段，但有可能列出原本Java代码中不存在的字段。


--------------

##方法表

--------------

* 包括了访问标志(access_flags)，名称索引(name_index)，描述符索引(descriptor_index)，属性表集合(attributes)。 

-------------

##属性表

------------

* Code 
* ConstantValue
* Desprecated
* Exception

----------

未完待续.........









