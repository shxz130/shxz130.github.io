---
layout : life
title : "mysql索引相关"
category : 深入学习Database
duoshuo: true
date : 2015-03-08
---

-------------

###Mysql设计优化

-------------

* **存储引擎的选择**
 * **Myisam**：数据库并发不大，读多写少,而且都能很好的用到索引，sql语句比较简单的应用，TB数据仓库.
 * **Innodb**: 并发访问大，写操作比较多，有外键、事务等需求的应用，系统内存较大.
* **命名规范**
 * 多数开发语言命名规则：比如MyAdress
 * 多数开源思想命名规则：my_address
* **字段类型选择**
 * 根据需求选择合适的字段类型，在满足需求的情况下字段类型尽可能小。
 * 只分配满足需求的最小字符数，不要太慷慨。
 * reason:更小的字段类型更小的字符数占用更少的内存，占用更少的磁盘空间，占用更少的磁盘IO，以及占用更少的带宽。
* **编码选择**
 * **latin1**：单字节
 * **utf-8**: 多字节，汉字占3个字节，英文字母占一个字节。
* **主键选择原则(主要正对innodb引擎)**
 * 能唯一的表示行。
 * 显式的定义一个数值类型自增字段的主键，这个字段可以仅用于做主键，不做其他用途。
 * MySQL主键应该是单列的，以便提高连接和筛选操作的效率。
 * 主键字段类型尽可能小，能用SMALLINT就不用INT，能用INT就不用BIGINT。
 * 尽量保证不对主键字段进行更新修改，防止主键字段发生变化，引发数据存储碎片，降低IO性能。
 * MySQL主键不应包含动态变化的数据，如时间戳、创建时间列、修改时间列等。
 * MySQL主键应当有计算机自动生成。
 * 主键字段放在数据表的第一顺序。
* **NULL OR NOT NULL**尽可能设置每个字段为NOT NULL，原因如下：
 * 使用含有NULL列做索引的话会占用更多的磁盘空间，因为索引NULL列需要而外的空间来保存。
 * 进行比较的时候，程序会更复杂。
 * 含有NULL的列比较特殊，SQL难优化，如果是一个组合索引，那么这个NULL 类型的字段会极大影响整个索引的效率。
* **索引**
 * 索引的缺点：极大地加速了查询，减少扫描和锁定的数据行数。
 * 索引的缺点：占用磁盘空间，减慢了数据更新速度，增加了磁盘IO。
 * **添加索引原则**：
  * 选择唯一性索引。
  * 为经常需要排序、分组和联合操作的字段建立索引。
  * 为常作为查询条件的字段建立索引。
  * 限制索引的数据，索引不是越多越好。
  * 尽量使用数据量少的索引，对于大字段可以考虑前缀索引。
  * 删除不再使用或者很少使用的索引。
  * 忌用字符串做主键.
 
---------------
 
###Mysql语句级优化
 
---------------
 
* 性能查的读语句，在innodb中统计行数,建议另外弄一张统计表，采用myisam，定期做统计.一般的对统计的数据不会要求太精准的情况下适用。
* 尽量不要在数据库中做运算。
* 避免负向查询和%前缀模糊查询。
* 不在索引列做运算或者使用函数
* 不要在生产环境程序中使用select * from 的形式查询数据。只查询需要使用的列。
* 查询尽可能使用limit减少返回的行数，减少数据传输时间和带宽浪费。
* where子句尽可能对查询列使用函数，因为对查询列使用函数用不到索引。
* 避免隐式类型转换，例如字符型一定要用’’，数字型一定不要使用’’。
* 所有的SQL关键词用大写，养成良好的习惯，避免SQL语句重复编译造成系统资源的浪费。
* 联表查询的时候，记得把小结果集放在前面，遵循小结果集驱动大结果集的原则。
* 开启慢查询，定期用explain优化慢查询中的SQL语句。

-----------------

[参考博文](http://blog.chinaunix.net/uid-20639775-id-3154234.html)

 