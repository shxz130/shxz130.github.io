---
layout : life
title : "深入理解jvm之GC(垃圾收集器)"
category : 深入理解JVM
duoshuo: true
date : 2014-11-05
---
------------

#完成的三件事情

-----------

* 哪些内存需要回收？
* 什么时候回收？
* 如何回收？

----------

#如何判断一个对象是否死亡？
###垃圾收集器在对堆进行回收前，第一件事情就是确定这些对象是否存活。

* 引用计数法
* 根搜索算法

----------

##引用计数法：

----------

* 给对象添加一个引用计数器，每当有一个地方需要引用它时，计数器值+1，当引用失效时，计数器值减1，如何计数器都为0的对象就是不可能为再被使用的。
* **问题**：无法解决对象之间的相互循环引用的问题。

----------
 {% highlight java %}
public class Text{
	public Object instance;
	
	public static void text()
	{
		Text a=new Text();
		Text b=new Text();
		a.instance=b;
		b.instance=a;
		a=null;
		b=null;
		System.gc;
		//假设在这里发生GC，a,b对象是否回收？
	}
}
{% endhighlight %}

-----------------

>由于a有一个引用指向b，b有一个引用指向a,导致相互引用，引用计数不为0，用引用计数法不能及时回收对象a,b。

-----------------

##根搜索算法(GC Roots Tracing)

-----------------

* **基本思路**：通过一系列的名为**GC Roots**的对象作为起点，从这些节点开始向下搜索，搜索走过的路径为引用链，当一个结点到GC Roots没有任何引用链连接，则证明该对象是不可用的，(图中D,E,G对象不可用)
* Java中可以作为GC Roots的对象包括：
	* 虚拟机栈中的引用的对象。
	* 方法区中的类静态属性引用的对象。
	* 方法区的常量引用的对象。
	* 本地方法栈中的JNI(Native方法)的引用的对象。
-------------------

![gengsuanfa](/life/picture/rootsuanfa.png)

-----------------


